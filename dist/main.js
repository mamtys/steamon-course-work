!function(e){var r={};function t(n){if(r[n])return r[n].exports;var o=r[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,t),o.l=!0,o.exports}t.m=e,t.c=r,t.d=function(e,r,n){t.o(e,r)||Object.defineProperty(e,r,{enumerable:!0,get:n})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,r){if(1&r&&(e=t(e)),8&r)return e;if(4&r&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(t.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&r&&"string"!=typeof e)for(var o in e)t.d(n,o,function(r){return e[r]}.bind(null,o));return n},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},t.p="",t(t.s=4)}([function(e,r){e.exports=require("express")},function(e,r){e.exports=require("passport")},function(e,r){e.exports=require("mongoose")},function(e,r,t){var n=t(2),o=new(0,n.Schema)({_id:{type:String,ref:"User"},telegram:{type:String,unique:!0},currancy:String},{versionKey:!1}),i=n.model("resInfo",o);e.exports=i},function(e,r,t){(function(r){var n=t(0),o=t(1),i=(t(5),t(6)),u=(t(8),t(9)),s=t(10),c=t(11),a=t(12),l=t(13),f=t(14);t(2).connect(f.mongodb.dbURI,{useNewUrlParser:!0}).then(function(){return console.log("Mongo connected")}).catch(function(){return console.log("Mongo connection err")});var d=t(15),p=t(17),m=t(18),g=t(19),h=(t(20),n()),v="production";h.locals.ENV=v,h.locals.ENV_DEVELOPMENT=!1,h.engine("handlebars",l({defaultLayout:"main",partialsDir:["views/partials/"]})),h.set("views",i.join(r,"views")),h.set("view engine","handlebars"),h.use(u("dev")),h.use(a.json()),h.use(a.urlencoded({extended:!0})),h.use(s()),h.use(n.static(i.join(r,"public"))),h.use(c({maxAge:864e5,keys:[f.session.cookieKey]})),h.use(o.initialize()),h.use(o.session()),h.use("/",d),h.use("/users",p),h.use("/auth",m),h.use("/profile",g),h.use(function(e,r,t){var n=new Error("Not Found");n.status=404,t(n)}),"development"===h.get("env")&&h.use(function(e,r,t,n){t.status(e.status||500),t.render("error",{message:e.message,error:e,title:"error"})}),h.use(function(e,r,t,n){t.status(e.status||500),t.render("error",{message:e.message,error:{},title:"error"})}),e.exports=h}).call(this,"/")},function(e,r){e.exports=require("express-session")},function(e,r,t){(function(e){function t(e,r){for(var t=0,n=e.length-1;n>=0;n--){var o=e[n];"."===o?e.splice(n,1):".."===o?(e.splice(n,1),t++):t&&(e.splice(n,1),t--)}if(r)for(;t--;t)e.unshift("..");return e}var n=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/,o=function(e){return n.exec(e).slice(1)};function i(e,r){if(e.filter)return e.filter(r);for(var t=[],n=0;n<e.length;n++)r(e[n],n,e)&&t.push(e[n]);return t}r.resolve=function(){for(var r="",n=!1,o=arguments.length-1;o>=-1&&!n;o--){var u=o>=0?arguments[o]:e.cwd();if("string"!=typeof u)throw new TypeError("Arguments to path.resolve must be strings");u&&(r=u+"/"+r,n="/"===u.charAt(0))}return(n?"/":"")+(r=t(i(r.split("/"),function(e){return!!e}),!n).join("/"))||"."},r.normalize=function(e){var n=r.isAbsolute(e),o="/"===u(e,-1);return(e=t(i(e.split("/"),function(e){return!!e}),!n).join("/"))||n||(e="."),e&&o&&(e+="/"),(n?"/":"")+e},r.isAbsolute=function(e){return"/"===e.charAt(0)},r.join=function(){var e=Array.prototype.slice.call(arguments,0);return r.normalize(i(e,function(e,r){if("string"!=typeof e)throw new TypeError("Arguments to path.join must be strings");return e}).join("/"))},r.relative=function(e,t){function n(e){for(var r=0;r<e.length&&""===e[r];r++);for(var t=e.length-1;t>=0&&""===e[t];t--);return r>t?[]:e.slice(r,t-r+1)}e=r.resolve(e).substr(1),t=r.resolve(t).substr(1);for(var o=n(e.split("/")),i=n(t.split("/")),u=Math.min(o.length,i.length),s=u,c=0;c<u;c++)if(o[c]!==i[c]){s=c;break}var a=[];for(c=s;c<o.length;c++)a.push("..");return(a=a.concat(i.slice(s))).join("/")},r.sep="/",r.delimiter=":",r.dirname=function(e){var r=o(e),t=r[0],n=r[1];return t||n?(n&&(n=n.substr(0,n.length-1)),t+n):"."},r.basename=function(e,r){var t=o(e)[2];return r&&t.substr(-1*r.length)===r&&(t=t.substr(0,t.length-r.length)),t},r.extname=function(e){return o(e)[3]};var u="b"==="ab".substr(-1)?function(e,r,t){return e.substr(r,t)}:function(e,r,t){return r<0&&(r=e.length+r),e.substr(r,t)}}).call(this,t(7))},function(e,r){var t,n,o=e.exports={};function i(){throw new Error("setTimeout has not been defined")}function u(){throw new Error("clearTimeout has not been defined")}function s(e){if(t===setTimeout)return setTimeout(e,0);if((t===i||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(r){try{return t.call(null,e,0)}catch(r){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:i}catch(e){t=i}try{n="function"==typeof clearTimeout?clearTimeout:u}catch(e){n=u}}();var c,a=[],l=!1,f=-1;function d(){l&&c&&(l=!1,c.length?a=c.concat(a):f=-1,a.length&&p())}function p(){if(!l){var e=s(d);l=!0;for(var r=a.length;r;){for(c=a,a=[];++f<r;)c&&c[f].run();f=-1,r=a.length}c=null,l=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===u||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(r){try{return n.call(null,e)}catch(r){return n.call(this,e)}}}(e)}}function m(e,r){this.fun=e,this.array=r}function g(){}o.nextTick=function(e){var r=new Array(arguments.length-1);if(arguments.length>1)for(var t=1;t<arguments.length;t++)r[t-1]=arguments[t];a.push(new m(e,r)),1!==a.length||l||s(p)},m.prototype.run=function(){this.fun.apply(null,this.array)},o.title="browser",o.browser=!0,o.env={},o.argv=[],o.version="",o.versions={},o.on=g,o.addListener=g,o.once=g,o.off=g,o.removeListener=g,o.removeAllListeners=g,o.emit=g,o.prependListener=g,o.prependOnceListener=g,o.listeners=function(e){return[]},o.binding=function(e){throw new Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(e){throw new Error("process.chdir is not supported")},o.umask=function(){return 0}},function(e,r){e.exports=require("serve-favicon")},function(e,r){e.exports=require("morgan")},function(e,r){e.exports=require("cookie-parser")},function(e,r){e.exports=require("cookie-session")},function(e,r){e.exports=require("body-parser")},function(e,r){e.exports=require("express-handlebars")},function(e,r){e.exports={mongodb:{dbURI:"mongodb+srv://admin:0216admin@cluster0-bhki0.mongodb.net/test?retryWrites=true"},session:{cookieKey:"somecookiekeymbencr"}}},function(e,r,t){var n=t(0).Router(),o=(t(1),t(16)),i=t(3);n.get("/",function(e,r){var t,n,u;t="-nameItem",n=10,u=function(t){var n,o;e.user?(n=e.user.id,o=function(n){r.render("index",{user:e.user,title:"Steamon",items:t,sets:n})},i.findById(n,function(e,r){e?console.error(e):o(r)})):r.render("index",{user:e.user,title:"Steamon",items:t})},o.find({}).sort(t).limit(n).exec(function(e,r){e?console.error(e):u(r)})}),n.get("/logout",function(e,r){e.logout(),r.redirect("/")}),n.get("/search",function(e,r){r.redirect("/")}),e.exports=n},function(e,r,t){var n=t(2),o=new(0,n.Schema)({itemName:String,gameName:String,smallPhoto:String,url:String},{versionKey:!1}),i=n.model("item",o);e.exports=i},function(e,r,t){var n=t(0).Router();n.get("/",function(e,r){r.send("respond with a resource")}),e.exports=n},function(e,r,t){var n=t(0).Router(),o=t(1);n.get("/steam",o.authenticate("steam",{failureRedirect:"/"}),function(e,r){r.redirect("/")}),n.get("/steam/return",o.authenticate("steam",{failureRedirect:"/"}),function(e,r){r.redirect("/")}),e.exports=n},function(e,r,t){var n=t(0).Router(),o=t(3),i=function(e,r,t){if(e.isAuthenticated())return t();r.redirect("/")};n.get("/",i,function(e,r){r.render("profile",{user:e.user})}),n.get("/settings",function(e,r){r.render("profile",{user:e.user})}),n.post("/",i,function(e,r){o.findById(e.user.id,function(r,t){if(r)console.error(r);else if(t)console.log("duplicate"+t),t.telegram=e.body.tel,t.currancy=e.body.cur,t.save();else{new o({_id:e.user.id,telegram:e.body.tel,currancy:e.body.cur}).save(function(e,r){e&&console.error(e),console.log(r+"created")})}}),console.log(e.user),r.redirect("/profile")}),e.exports=n},function(e,r,t){var n=t(1),o=t(21).Strategy,i=t(22);n.serializeUser(function(e,r){r(null,e.id)}),n.deserializeUser(function(e,r){i.findById(e,function(e,t){e?r(e):r(null,t)})}),n.use(new o({returnURL:"http://localhost:3000/auth/steam/return",realm:"http://localhost:3000/",apiKey:"0E85BB8884ECE2534C417A4F4A6A7CF8"},function(e,r,t){i.findById(r.id).then(function(e){if(console.log(e),e)console.log("duplicate"+e),t(null,e);else{var n=new i({_id:r.id,displayName:r.displayName,smallAvatar:r.smallAvatar});n.save(function(e,r){e&&console.error(e),console.log(r," registred ",Date.now())}),t(null,n)}})}))},function(e,r){e.exports=require("passport-steam")},function(e,r,t){var n=t(2),o=new(0,n.Schema)({_id:String,displayName:String,smallAvatar:String},{versionKey:!1}),i=n.model("user",o);e.exports=i}]);
//# sourceMappingURL=main.js.map